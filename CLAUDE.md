# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Personal dotfiles repository optimized for macOS Sequoia 15.x. Manages configuration files through symbolic links, with automated backup and setup workflows.

## Key Commands

### Bootstrap and Setup
- **Install dotfiles**: `./scripts/bootstrap/bootstrap-dotfiles.sh` - Creates 11 symbolic links, installs pre-commit hooks, and configures brew autoupdate (86400s interval). Shows preview before execution and requires confirmation.
- **Install Oh My Zsh**: `./scripts/bootstrap/bootstrap-omz.sh` - Installs Oh My Zsh and these plugins:
  - zsh-autosuggestions
  - zsh-syntax-highlighting
  - fast-syntax-highlighting
  - zsh-autocomplete

### Fortune Files Management
- **Generate fortune .dat files**: `./configs/fortune/strfile.sh` - Processes all .fortune files in the fortune directory
- **Manual fortune generation**: `strfile <fortune_file>` for individual files (run from fortune directory)
- **Note**: .dat files are auto-generated by pre-commit hook on every commit when .fortune files change

### Package Management
- **Backup/restore packages**: `./scripts/package-managers/manage-krew-brew.sh` - Interactive menu with three options:
  - Option 1: Backup krew plugins to `configs/krew/Krewfile`
  - Option 2: Restore krew plugins from backup
  - Option 3: Manual Brewfile creation with package counts summary (taps, brews, casks, mas, vscode)

### Git Operations
- **Clone repositories**: `./scripts/git/clone-all.sh` - Bulk clone all GitHub repositories for user "younsl" with confirmation prompt
- **Clean commit history**: `./scripts/git/commit-history-cleaner.sh` or `./commit-history-cleaner.sh` - **DESTRUCTIVE**: Removes all commit history and force pushes to remote

## Architecture

### Configuration Structure
The repository follows a centralized config approach:
- `configs/` contains all dotfile configurations organized by tool
- Bootstrap script creates symbolic links from configs to standard locations (`~/.config/`, `~/.gnupg/`, `~/.zshrc`)
- Each tool has its own subdirectory with tool-specific configurations

### Symbolic Link Mappings
The COMPONENTS array in `bootstrap-dotfiles.sh:5-17` defines these mappings:
```
fortune          → ~/.config/fortune
git              → ~/.config/git
k9s              → ~/.config/k9s
ghostty          → ~/.config/ghostty
nvim             → ~/.config/nvim
pip              → ~/.config/pip
zshrc            → ~/.zshrc (special case: links from configs/zsh/.zshrc)
fastfetch        → ~/.config/fastfetch
gnupg/gpg.conf   → ~/.gnupg/gpg.conf
gnupg/gpg-agent.conf → ~/.gnupg/gpg-agent.conf
gnupg/common.conf → ~/.gnupg/common.conf
```

### Key Components
- **Bootstrap system**: Automated symbolic link creation with preview and confirmation. Creates parent directories automatically.
- **Fortune management**: 10 custom fortune files (career, crypto, devops, general, philosophy, programming, science, security, sre, tech) with automated .dat generation via pre-commit hooks
- **Package management**: Unified backup/restore for both Homebrew and kubectl krew
- **Pre-commit automation**: Two hooks run on every commit:
  1. `strfile-fortune`: Auto-generates .dat files when .fortune files change (configs/fortune/*.fortune)
  2. `backup-brewfile`: Backs up Homebrew packages once per day (tracks date in `.brewfile-last-backup`), appends summary section with package counts, and auto-stages Brewfile to git

### Tool Configurations
Key tools configured in this repository:
- **Neovim**: Modular configuration with Lazy.nvim plugin manager. Core config split into separate modules (config/lazy, core/options, core/keymaps)
- **k9s**: Kubernetes TUI with 20+ color skins, custom aliases, plugins, and view configurations
- **Git**: Multiple config profiles (younsl, coinone), gitmessage template, GPG signing key
- **Zsh**: Oh My Zsh with plugins including git, zsh-syntax-highlighting, zsh-autosuggestions, fast-syntax-highlighting, zsh-autocomplete, tmux, autojump, fzf, kubectl, aws, kube-ps1
- **Ghostty**: Terminal emulator configuration
- **fastfetch**: System info display (JSONC config + images)

## Development Workflow

### Modifying Configurations
1. **Always edit source files in `configs/<tool>/`** - Never edit the symlinked versions (e.g., never edit `~/.config/nvim`, edit `configs/nvim` instead)
2. For fortune files: Only edit `.fortune` files - `.dat` files are auto-generated by pre-commit hook
3. Test changes by running the bootstrap script to verify symlinks
4. Commit changes - pre-commit hooks will automatically:
   - Generate .dat files from modified .fortune files
   - Backup Brewfile once per day (if not already backed up today)

### Initial Setup After Clone
```bash
./scripts/bootstrap/bootstrap-dotfiles.sh  # Creates symlinks, installs pre-commit, configures brew autoupdate
./scripts/bootstrap/bootstrap-omz.sh       # Optional: Install Oh My Zsh with plugins
```

### Pre-commit Hook Installation
Pre-commit hooks are automatically installed by the bootstrap script. To manually reinstall:
```bash
pre-commit install
```

## Important Notes

### Critical Rules
- **Never edit symlinked files directly** - Always edit source files in `configs/`
- **Fortune .dat files are auto-generated** - Only modify .fortune source files
- **Brewfile is auto-backed up daily** - First commit of each day triggers backup
- **Hard-coded paths**: Bootstrap script expects repository at `$HOME/github/younsl/dotfiles` (see DOTFILES_DIR in bootstrap-dotfiles.sh:3)

### System Requirements
- macOS Sequoia 15.x
- Homebrew (for package management and pre-commit installation)
- `strfile` (from fortune package, required for fortune file generation)
- `pre-commit` (auto-installed by bootstrap script if missing)
- `kubectl` and `kubectl krew` (optional, for krew backup/restore functionality)

### Brew Autoupdate Configuration
The bootstrap script configures brew autoupdate with these settings:
- Interval: 86400 seconds (24 hours)
- Flags: `--upgrade --cleanup --immediate`
- Service: Runs via launchd in background

### Pre-commit Hook Implementation
Both hooks defined in `.pre-commit-config.yaml` use `language: system` (native bash, no external dependencies) and `always_run: true`:
- **strfile-fortune**: Runs on every commit, processes all `configs/fortune/*.fortune` files to generate corresponding .dat files
- **backup-brewfile**: Runs on every commit but only executes backup once per day. Uses `.brewfile-last-backup` timestamp file to track last backup date. When backing up, runs `brew bundle dump` and appends package count summary (taps, brews, casks, mas, vscode), then auto-stages Brewfile to git
